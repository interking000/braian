<!DOCTYPE html>
<html lang="es-AR" translate="no" data-bs-theme="dark">
<head>
  <meta charset="utf-8">
  <base href="/" target="_blank">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="google" content="notranslate">
  <link rel="shortcut icon" href="../static/img/favicon.svg" />
  <title>Configuraciones</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <link rel="stylesheet" href="../static/css/styles.css">
  <link rel="stylesheet" href="../static/css/bootstrap.css">
  <link rel="stylesheet" href="../static/css/sidebar.css">
  <link rel="stylesheet" href="../static/css/header.css">

  <script src="../static/js/dark_light.js"></script>
  <script src="//code.jquery.com/jquery-2.1.0.min.js"></script>
  <link href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css" rel="stylesheet" />
  <meta name="csrf-token" content="<%= it.csrfToken %>">

  <style>
    /* ==========================
       üé® Elegante mate (Obsidiana + Lavanda + Aqua humo)
       ========================== */
    :root{
      --bg1:#070A10;
      --bg2:#0B1020;

      --panel:#0E1424;
      --panel2:#0B1020;

      --accent:#8B5CF6;
      --accent2:#22D3EE;
      --accent3:#A78BFA;

      --line: rgba(167,139,250,.22);

      --text:#EAF0FF;
      --muted:#AAB3D6;

      --radius:18px;

      --shadow: 0 18px 55px rgba(0,0,0,.65);
      --ring: 0 0 0 3px rgba(139,92,246,.18);
      --softGlow: 0 0 0 1px rgba(167,139,250,.14), 0 12px 28px rgba(0,0,0,.55);
      --softGlow2: 0 0 0 1px rgba(34,211,238,.12), 0 18px 40px rgba(0,0,0,.62);
    }

    body{
      min-height:100vh;
      color:var(--text);
      background:
        radial-gradient(950px 520px at 18% 12%, rgba(139,92,246,.18), transparent 62%),
        radial-gradient(900px 520px at 82% 14%, rgba(34,211,238,.14), transparent 60%),
        radial-gradient(900px 620px at 50% 92%, rgba(167,139,250,.10), transparent 62%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      background-attachment: fixed;
      overflow-x:hidden;
    }

    main.d-flex{ min-height:100vh; justify-content:center; }
    .container-fluid{ max-width: 1250px; width: 100%; }
    .content{
      display:flex; justify-content:center; align-items:center;
      min-height: calc(100vh - 80px);
      padding: 16px;
    }

    .content > .card{
      width:100%; max-width:1120px;
      border-radius: calc(var(--radius) + 6px);
      background: linear-gradient(180deg, rgba(14,20,36,.92), rgba(11,16,32,.92));
      border: 1px solid rgba(167,139,250,.24) !important;
      box-shadow: var(--shadow), 0 0 0 1px rgba(34,211,238,.05);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }
    .content > .card::before{
      content:"";
      position:absolute; inset:-2px -2px auto -2px; height: 110px;
      background:
        radial-gradient(380px 110px at 16% 30%, rgba(139,92,246,.22), transparent 65%),
        radial-gradient(560px 110px at 70% 30%, rgba(34,211,238,.18), transparent 65%),
        linear-gradient(90deg, rgba(139,92,246,.10), rgba(34,211,238,.06));
      pointer-events:none;
      border-bottom: 1px solid rgba(167,139,250,.14);
    }

    .card-body{ padding: 18px; position:relative; }

    .text-gray-800{
      color: var(--text) !important;
      letter-spacing: .14em;
      text-shadow: none;
    }

    /* Panel filtros/b√∫squeda */
    .control-grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-bottom: 14px;
    }
    .neo-panel{
      border-radius: var(--radius);
      background: rgba(11,16,32,.66);
      border: 1px solid rgba(167,139,250,.18);
      box-shadow: inset 0 0 0 1px rgba(34,211,238,.03);
      padding: 12px;
    }
    .neo-panel-title{
      font-size: .78rem;
      letter-spacing:.14em;
      text-transform: uppercase;
      color: rgba(170,179,214,.92);
      margin: 0 0 10px;
      display:flex; align-items:center; gap:8px;
    }
    .neo-panel-title i{ color: rgba(34,211,238,.90); }

    .mini-label{
      display:block;
      font-size:.75rem;
      letter-spacing:.14em;
      text-transform: uppercase;
      color: rgba(170,179,214,.85);
      margin: 0 0 6px;
    }

    /* Inputs */
    .form-select, .form-control, .input-group-text{
      background: rgba(7,10,18,.86) !important;
      color: var(--text) !important;
      border: 1px solid rgba(167,139,250,.18) !important;
      border-radius: 14px !important;
    }
    .form-control::placeholder{ color: rgba(170,179,214,.70) !important; }
    .form-select:focus, .form-control:focus{
      box-shadow: var(--ring) !important;
      border-color: rgba(34,211,238,.36) !important;
    }

    /* Botones base */
    .btn{
      border-radius: 14px !important;
      border: 1px solid rgba(167,139,250,.18) !important;
      color: var(--text) !important;
      transition: transform .08s ease, box-shadow .2s ease, filter .2s ease;
      box-shadow: 0 10px 22px rgba(0,0,0,.42);
      background: rgba(7,10,18,.72);
    }
    .btn:hover{
      transform: translateY(-1px);
      box-shadow: var(--softGlow);
      filter: brightness(1.03);
    }
    .btn:active{ transform: translateY(0); filter: brightness(.99); }

    /* ‚úÖ Bot√≥n eliminar seleccionados (al lado de VER) */
    .btn-danger-soft{
      border-radius: 14px !important;
      background:
        radial-gradient(120px 70px at 20% 30%, rgba(239,68,68,.18), transparent 62%),
        linear-gradient(135deg, rgba(7,10,18,.86), rgba(11,16,32,.92)) !important;
      border: 1px solid rgba(239,68,68,.22) !important;
      box-shadow: 0 0 0 1px rgba(239,68,68,.10), 0 12px 28px rgba(0,0,0,.55);
    }
    .btn-danger-soft i{ color: rgba(248,113,113,.95); }
    .btn-danger-soft:hover{ box-shadow: 0 0 0 1px rgba(239,68,68,.18), 0 18px 40px rgba(0,0,0,.62); }

    /* ==========================================
       ‚úÖ HERRAMIENTAS flotante (panel cierra solo al tocar una opci√≥n)
       ========================================== */
    .tools-fab{
      position: fixed;
      right: 18px;
      bottom: 18px;
      z-index: 1090;
      display:flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 10px;
    }
    .tools-btn{
      padding: 12px 14px !important;
      border-radius: 999px !important;
      background:
        radial-gradient(120px 60px at 20% 30%, rgba(34,211,238,.22), transparent 60%),
        radial-gradient(160px 70px at 70% 30%, rgba(139,92,246,.26), transparent 65%),
        linear-gradient(135deg, rgba(7,10,18,.88), rgba(11,16,32,.92)) !important;
      border: 1px solid rgba(34,211,238,.18) !important;
      box-shadow: var(--softGlow2) !important;
      backdrop-filter: blur(12px);
      display:flex; align-items:center; gap:10px;
      font-weight: 900;
      letter-spacing: .12em;
      text-transform: uppercase;
    }
    .tools-btn i{ color: rgba(34,211,238,.92); }

    .tools-panel{
      width: min(360px, calc(100vw - 24px));
      border-radius: 18px;
      background: rgba(11,16,32,.92);
      border: 1px solid rgba(167,139,250,.18);
      box-shadow: var(--shadow), 0 0 0 1px rgba(34,211,238,.06);
      overflow: hidden;
    }
    .tools-panel .tools-head{
      padding: 12px 14px;
      background: linear-gradient(90deg, rgba(34,211,238,.10), rgba(11,16,32,.92), rgba(139,92,246,.10));
      border-bottom: 1px solid rgba(167,139,250,.12);
      display:flex; align-items:center; justify-content:space-between;
    }
    .tools-panel .tools-head .t-title{
      font-size:.78rem;
      letter-spacing:.14em;
      text-transform: uppercase;
      color: rgba(170,179,214,.92);
      margin:0;
      display:flex; gap:8px; align-items:center;
    }
    .tools-panel .tools-body{ padding: 12px 12px 14px; }
    .tools-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .tools-grid .btn{ width:100%; }
    .tools-panel .btn.btn-dark{
      background: linear-gradient(135deg, rgba(139,92,246,.18), rgba(7,10,18,.86)) !important;
      border-color: rgba(34,211,238,.14) !important;
      box-shadow: 0 10px 20px rgba(0,0,0,.50);
    }

    @media (max-width: 480px){
      .tools-grid{ grid-template-columns: 1fr; }
      .tools-btn span{ display:none; }
      .tools-btn{ padding: 12px !important; }
    }

    /* ===========================
       ‚úÖ LISTA EN CUADROS (cards)
       - PC: 2 columnas
       - CELU: 2 columnas
       =========================== */
    .table-responsive{
      border-radius: 18px;
      border: 1px solid rgba(167,139,250,.16);
      background: rgba(11,16,32,.58);
      box-shadow: inset 0 0 0 1px rgba(34,211,238,.03);
      overflow: hidden;
      padding: 10px;
    }

    table.table.neon-cards{ width:100%; margin:0; }
    table.table.neon-cards thead{ display:none !important; }

    table.table.neon-cards tbody{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    table.table.neon-cards tbody tr{
      display:block;
      position: relative;
      border-radius: 16px;
      background: rgba(11,16,32,.86);
      border: 1px solid rgba(167,139,250,.16);
      box-shadow: 0 0 0 1px rgba(34,211,238,.04), 0 16px 28px rgba(0,0,0,.45);
      padding: 10px;
      overflow: visible;
      min-height: 128px;
    }

    table.table.neon-cards tbody tr::before{
      content:"";
      position:absolute; inset:0 0 auto 0; height:44px;
      background:
        radial-gradient(240px 44px at 20% 30%, rgba(34,211,238,.10), transparent 65%),
        radial-gradient(360px 44px at 70% 30%, rgba(139,92,246,.12), transparent 65%);
      border-bottom: 1px solid rgba(167,139,250,.10);
      pointer-events:none;
    }

    table.table.neon-cards td,
    table.table.neon-cards th{
      border: 0 !important;
      padding: 0 !important;
      background: transparent !important;
      color: var(--text) !important;
      overflow: visible !important;
    }

    .cfg-top{
      position: relative;
      display:flex;
      flex-wrap: wrap;
      align-items:flex-start;
      justify-content: space-between;
      gap: 8px 10px;
      padding: 8px 6px 8px;
      margin-bottom: 8px;
    }
    .cfg-left{ display:flex; align-items:flex-start; gap: 8px; min-width: 0; flex: 1 1 240px; }
    .cfg-title{
      font-weight: 950;
      letter-spacing: .02em;
      font-size: .98rem;
      white-space: normal;
      overflow: visible;
      text-overflow: unset;
      max-width: none;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .cfg-switch{
      display:flex;
      flex-wrap: wrap;
      align-items:center;
      gap:8px;
      justify-content:flex-end;
      flex: 0 0 auto;
    }

    .status-badge{
      font-size: .70rem;
      letter-spacing: .12em;
      text-transform: uppercase;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(34,211,238,.16);
      background: rgba(7,10,18,.60);
      color: rgba(170,179,214,.92);
      white-space: nowrap;
    }
    .status-badge.active{
      border-color: rgba(34,211,238,.32);
      box-shadow: 0 0 0 2px rgba(34,211,238,.10);
      color: rgba(232,242,255,.95);
    }

    /* ‚úÖ body: meta | acciones */
    .cfg-body{
      position: relative;
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      padding: 0 6px 2px;
      align-items: start;
    }

    .cfg-meta{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px 12px;
      font-size: .86rem;
      color: rgba(234,240,255,.92);
    }
    .cfg-line{ display:flex; gap: 6px; align-items: baseline; flex-wrap: wrap; }
    .meta-label{
      color: rgba(170,179,214,.92);
      font-weight: 900;
      font-size: .80rem;
      letter-spacing: .02em;
    }
    .meta-value{ color: rgba(234,240,255,.95); font-weight: 650; }

    .cfg-actions{
      display:flex;
      flex-direction: column;
      gap: 7px;
      align-items: flex-end;
      justify-content: center;
      min-width: 118px;
    }
    .cfg-actions .btn{
      width: 42px;
      height: 36px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:0 !important;
      border-radius: 12px !important;
      background: rgba(7,10,18,.70) !important;
      border-color: rgba(167,139,250,.16) !important;
      box-shadow: 0 0 0 1px rgba(34,211,238,.05), 0 10px 18px rgba(0,0,0,.45);
    }
    .cfg-actions .btn i{ font-size: 1.02rem; color: rgba(34,211,238,.90); }

    /* Oculta copiar */
    .cfg-actions .bi-clipboard,
    .cfg-actions .bi-clipboard-fill,
    .cfg-actions .bi-copy,
    .cfg-actions .bi-files{ display:none !important; }

    /* Switch */
    .form-check-input{
      background-color: rgba(7,10,18,.86) !important;
      border: 1px solid rgba(167,139,250,.16) !important;
    }
    .form-check-input:checked{
      background-color: rgba(34,211,238,.85) !important;
      border-color: rgba(34,211,238,.55) !important;
      box-shadow: 0 0 0 3px rgba(34,211,238,.16) !important;
    }

    @media (max-width: 820px){
      table.table.neon-cards tbody{ grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 540px){
      .cfg-body{ grid-template-columns: 1fr; }
      .cfg-actions{ flex-direction: row; justify-content:flex-start; min-width: 0; }
      .cfg-actions .btn{ width: 44px; }
      .cfg-meta{ grid-template-columns: 1fr; }
    }
    @media (max-width: 360px){
      table.table.neon-cards tbody{ grid-template-columns: 1fr; }
    }

    /* ===========================
       ‚úÖ MODALES: m√°s compactos y elegantes (sin tocar l√≥gica)
       =========================== */
    @keyframes popIn {
      from { transform: translateY(10px) scale(.98); opacity: 0; }
      to   { transform: translateY(0) scale(1); opacity: 1; }
    }
    .modal.show .modal-dialog{ animation: popIn .18s ease-out; }

    /* ‚úÖ Achica el modal (aplica tanto a crear como editar si usan bootstrap modal) */
    .modal-dialog{
      max-width: 520px !important;         /* m√°s peque√±o */
      margin: 1.35rem auto !important;
    }
    @media (max-width: 540px){
      .modal-dialog{ max-width: calc(100vw - 18px) !important; }
    }

    .modal-content{
      background: rgba(11,16,32,.96) !important;
      border: 1px solid rgba(167,139,250,.16) !important;
      border-radius: 18px !important;
      box-shadow: var(--shadow), 0 0 0 1px rgba(34,211,238,.06) !important;
      backdrop-filter: blur(14px);
      color: var(--text) !important;
      overflow: hidden;
    }
    .modal-header, .modal-footer{
      border-color: rgba(167,139,250,.10) !important;
      background: linear-gradient(90deg, rgba(34,211,238,.10), rgba(11,16,32,.92), rgba(139,92,246,.10)) !important;
      padding: .85rem 1rem !important; /* m√°s compacto */
    }
    .modal-body{
      padding: 1rem !important; /* m√°s compacto */
    }
    .modal-title{
      letter-spacing:.14em;
      text-transform: uppercase;
      color: var(--text) !important;
      font-size: .95rem !important; /* m√°s fino */
    }
    .btn-close{ filter: invert(1) brightness(1.15); opacity: .85; }
    .btn-close:hover{ opacity: 1; }

    /* Botones de modal */
    .modal-footer .btn{
      border-radius: 14px !important;
      border: 1px solid rgba(34,211,238,.18) !important;
      background: linear-gradient(135deg, rgba(139,92,246,.22), rgba(7,10,18,.88)) !important;
      box-shadow: var(--softGlow) !important;
      padding: .55rem .9rem !important;
    }
    .modal-footer .btn.btn-secondary,
    .modal-footer .btn.btn-outline-secondary{
      background: rgba(7,10,18,.78) !important;
      border-color: rgba(167,139,250,.16) !important;
      box-shadow: inset 0 0 0 1px rgba(34,211,238,.05) !important;
    }

    /* Inputs dentro del modal (un poco m√°s compactos) */
    .modal .form-control,
    .modal .form-select,
    .modal .input-group-text{
      border-radius: 12px !important;
      padding-top: .55rem !important;
      padding-bottom: .55rem !important;
    }

    /* Paginaci√≥n */
    #pagination .page-link{
      background: rgba(7,10,18,.86) !important;
      color: var(--text) !important;
      border: 1px solid rgba(167,139,250,.14) !important;
    }
    #pagination .page-link:focus{ box-shadow: var(--ring) !important; }
  </style>
</head>

<body>
  <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js"></script>

  <main class="d-flex">
    <%~ include("./sidebar", it) %>

    <div class="container-fluid p-0">
      <%~ include("./header", it) %>

      <div class="content pt-1 overflow-auto">
        <div class="card shadow border border-0 overflow-auto h-100">
          <div class="card-body m-0">

            <h1 class="h3 mb-3 text-gray-800 text-uppercase">TUS SERVIDORES</h1>

            <div class="control-grid">
              <div class="neo-panel">
                <div class="neo-panel-title">
                  <i class="bi bi-funnel"></i> Filtros y b√∫squeda
                </div>

                <div class="d-flex flex-wrap gap-2 align-items-end">
                  <div class="d-flex flex-column">
                    <span class="mini-label">Ver</span>
                    <select class="form-select config-status" style="width: auto">
                      <option value="ACTIVE">Activos</option>
                      <option value="INACTIVE">Inactivos</option>
                      <option value="ALL">Todos</option>
                    </select>
                  </div>

                  <!-- ‚úÖ Eliminar seleccionados al lado de "Ver" (misma clase delete-config) -->
                  <div class="d-flex flex-column">
                    <span class="mini-label">&nbsp;</span>
                    <button type="button" class="btn btn-danger-soft delete-config" title="Eliminar seleccionados">
                      <i class="bi bi-trash3"></i> <span class="d-none d-sm-inline">Eliminar seleccionados</span>
                    </button>
                  </div>

                  <div class="search-config input-group flex-grow-1">
                    <input class="form-control" type="search" placeholder="Buscar" aria-label="Buscar">
                    <button class="input-group-text border-1" type="submit" aria-label="Buscar">
                      <i class="bi bi-search"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div id="root"></div>

            <div class="d-none config-not-found d-flex justify-content-center align-items-center p-3">
              <h4 class="text-muted text-nowrap" style="color: rgba(170,179,214,.78) !important;">
                No se encontr√≥ ning√∫n servidor
              </h4>
            </div>

            <div id="pagination" class="mt-2"></div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- HERRAMIENTAS flotante -->
  <div class="tools-fab">
    <div class="collapse" id="toolsPanel">
      <div class="tools-panel">
        <div class="tools-head">
          <p class="t-title m-0"><i class="bi bi-tools"></i> Herramientas</p>
          <button class="btn btn-sm btn-dark" type="button" data-bs-toggle="collapse" data-bs-target="#toolsPanel" aria-label="Cerrar herramientas">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        <div class="tools-body">
          <div class="tools-grid">
            <!-- Mantengo clases para no romper l√≥gica -->
            <button type="button" class="btn btn-dark create-config">
              <i class="bi bi-plus-lg"></i> <span>CREAR</span>
            </button>
            <button type="button" class="btn btn-dark import-config">
              <i class="bi bi-file-earmark-arrow-up"></i> <span>IMPORTAR</span>
            </button>
            <button type="button" class="btn btn-dark export-config">
              <i class="bi bi-file-earmark-arrow-down"></i> <span>EXPORTAR</span>
            </button>
            <button type="button" class="btn btn-dark delete-config">
              <i class="bi bi-trash"></i> <span>ELIMINAR</span>
            </button>
          </div>

          <button type="button" class="btn btn-dark flex-fill mt-2 release-update invisible">
            <i class="bi bi-send"></i>
            <span>EDITAR NOTAS</span>
          </button>
        </div>
      </div>
    </div>

    <button class="btn tools-btn" type="button" data-bs-toggle="collapse" data-bs-target="#toolsPanel" aria-expanded="false" aria-controls="toolsPanel">
      <i class="bi bi-grid-3x3-gap-fill"></i>
      <span>HERRAMIENTAS</span>
    </button>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="../static/js/sidebar.js"></script>
  <script src="../static/js/utils.js"></script>

  <script>
    const startLoader = () => {
      const html = `
        <div class="table-responsive text-center rounded">
            <table class="table table-striped mb-0 neon-cards">
                <thead>
                    <tr><th></th><th>#</th><th>Nombre</th><th>Categor√≠a</th><th>Orden</th><th>Modo</th><th>Estado</th><th>Acciones</th></tr>
                </thead>
                <tbody>
                    <tr>
                      <td><input class="form-check form-check-input" type="checkbox"></td>
                      <td><span class="placeholder-glow"><span class="placeholder w-100 rounded rounded-pill"></span></span></td>
                      <td><span class="placeholder-glow"><span class="placeholder w-100 rounded rounded-pill"></span></span></td>
                      <td><span class="placeholder-glow"><span class="placeholder w-100 rounded rounded-pill"></span></span></td>
                      <td><span class="placeholder-glow"><span class="placeholder w-100 rounded rounded-pill"></span></span></td>
                      <td><span class="placeholder-glow"><span class="placeholder w-100 rounded rounded-pill"></span></span></td>
                      <td>
                        <span class="placeholder-glow">
                          <div class="form-check form-switch d-flex justify-content-center">
                            <input class="form-check-input disabled placeholder" type="checkbox" role="switch" checked>
                          </div>
                        </span>
                      </td>
                      <td>
                        <span class="placeholder-glow">
                          <button class="btn btn-sm btn-dark disabled placeholder" style="width: 40px; height:34px;"></button>
                          <button class="btn btn-sm btn-dark disabled placeholder" style="width: 40px; height:34px;"></button>
                          <button class="btn btn-sm btn-dark disabled placeholder" style="width: 40px; height:34px;"></button>
                        </span>
                      </td>
                    </tr>
                </tbody>
            </table>
        </div>`;
      const root = document.querySelector('#root');
      root.innerHTML = html;

      const tbody = root.querySelector('tbody');
      const row = tbody.children[0];
      tbody.innerHTML = '';
      for (let i = 0; i < 6; i++) tbody.appendChild(row.cloneNode(true));
    };

    const escapeHtml = (s) =>
      String(s).replace(/[&<>"']/g, (m) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));

    // ‚úÖ Cards en grilla + meta 2 columnas + sin copiar + SIN ‚ÄúNombre de servidor‚Äù
    const enhanceConfigCards = () => {
      const root = document.querySelector('#root');
      if (!root) return;

      const table = root.querySelector('table.table');
      if (!table) return;

      if (table.dataset.neonCards === "1") return;
      table.dataset.neonCards = "1";
      table.classList.add('neon-cards');

      const rows = table.querySelectorAll('tbody tr');
      rows.forEach(tr => {
        if (tr.dataset.cardified === "1") return;
        tr.dataset.cardified = "1";

        const cells = tr.querySelectorAll('th, td');
        if (cells.length < 8) return;

        const tdCheck = cells[0];
        const tdNum   = cells[1];
        const tdName  = cells[2];
        const tdCat   = cells[3];
        const tdOrd   = cells[4];
        const tdMode  = cells[5];
        const tdStat  = cells[6];
        const tdAct   = cells[7];

        const nameText = (tdName.textContent || '').trim();
        const catText  = (tdCat.textContent || '').trim();
        const modeText = (tdMode.textContent || '').trim();

        const switchWrap = tdStat.querySelector('.form-switch') || tdStat.querySelector('.form-check') || tdStat;
        const switchInput = tdStat.querySelector('input[type="checkbox"]');
        const isActive = switchInput ? !!switchInput.checked : false;

        // Quitar copiar
        Array.from(tdAct.querySelectorAll('button, a')).forEach(btn => {
          const ico = btn.querySelector('i');
          const iconClass = ico ? (ico.className || '') : '';
          const t = (btn.getAttribute('title') || '') + ' ' + (btn.textContent || '');
          const lower = t.toLowerCase();
          const looksLikeCopy =
            iconClass.includes('clipboard') ||
            iconClass.includes('bi-copy') ||
            iconClass.includes('bi-files') ||
            lower.includes('copiar') ||
            lower.includes('copy') ||
            lower.includes('duplic');
          if (looksLikeCopy) btn.remove();
        });

        // Header
        const header = document.createElement('div');
        header.className = 'cfg-top';

        const left = document.createElement('div');
        left.className = 'cfg-left';

        const checkEl = tdCheck.querySelector('input, .form-check') || tdCheck;
        left.appendChild(checkEl);

        const title = document.createElement('div');
        title.className = 'cfg-title';
        title.textContent = nameText || '‚Äî';
        left.appendChild(title);

        header.appendChild(left);

        const right = document.createElement('div');
        right.className = 'cfg-switch';

        const badge = document.createElement('span');
        badge.className = 'status-badge ' + (isActive ? 'active' : 'inactive');
        badge.textContent = isActive ? 'Activo' : 'Inactivo';
        right.appendChild(badge);

        if (switchWrap && switchWrap !== tdStat) right.appendChild(switchWrap);
        else if (tdStat) right.appendChild(tdStat);

        header.appendChild(right);

        // Body (meta + acciones)
        const body = document.createElement('div');
        body.className = 'cfg-body';

        const meta = document.createElement('div');
        meta.className = 'cfg-meta';

        const line2 = document.createElement('div');
        line2.className = 'cfg-line';
        line2.innerHTML = `<span class="meta-label">Categor√≠a:</span> <span class="meta-value">${escapeHtml(catText || '‚Äî')}</span>`;

        const line3 = document.createElement('div');
        line3.className = 'cfg-line';
        line3.innerHTML = `<span class="meta-label">Modo:</span> <span class="meta-value">${escapeHtml(modeText || '‚Äî')}</span>`;

        meta.appendChild(line2);
        meta.appendChild(line3);

        const actions = document.createElement('div');
        actions.className = 'cfg-actions';
        Array.from(tdAct.querySelectorAll('button, a')).forEach(btn => actions.appendChild(btn));

        body.appendChild(meta);
        body.appendChild(actions);

        tdName.innerHTML = '';
        tdName.appendChild(header);
        tdName.appendChild(body);

        // Oculta celdas originales (se mantiene DOM para l√≥gica)
        tdNum.style.display  = 'none';
        tdCat.style.display  = 'none';
        tdOrd.style.display  = 'none';
        tdMode.style.display = 'none';
        tdStat.style.display = 'none';
        tdAct.style.display  = 'none';
        tdCheck.style.display = 'none';
      });
    };

    // ‚úÖ Herramientas: cerrar panel autom√°ticamente al elegir una opci√≥n
    const setupToolsAutoClose = () => {
      const panelEl = document.getElementById('toolsPanel');
      if (!panelEl || !window.bootstrap) return;

      const collapse = bootstrap.Collapse.getOrCreateInstance(panelEl, { toggle: false });

      panelEl.addEventListener('click', (e) => {
        const btn = e.target.closest('button, a');
        if (!btn) return;

        const shouldClose =
          btn.classList.contains('create-config') ||
          btn.classList.contains('import-config') ||
          btn.classList.contains('export-config') ||
          btn.classList.contains('delete-config') ||
          btn.classList.contains('release-update');

        if (shouldClose) collapse.hide();
      });
    };

    // Observa render din√°mico en #root
    const rootObserver = new MutationObserver(() => enhanceConfigCards());

    window.addEventListener('DOMContentLoaded', () => {
      const root = document.querySelector('#root');
      if (root) {
        enhanceConfigCards();
        rootObserver.observe(root, { childList: true, subtree: true });
      }
      setupToolsAutoClose();
    });
  </script>

  <script type="module" src="../static/js/config/main.js"></script>
</body>
</html>